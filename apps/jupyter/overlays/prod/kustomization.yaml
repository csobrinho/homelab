# See https://github.com/jupyterhub/zero-to-jupyterhub-k8s/blob/main/jupyterhub/values.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ../../base
  - ingress-route.yaml

helmCharts:
  - name: jupyterhub
    repo: https://hub.jupyter.org/helm-chart/
    releaseName: jupyter
    namespace: jupyter
    version: 4.0.0
    includeCRDs: true
    valuesInline:
      hub:
        extraEnv:
          TZ: America/Los_Angeles
        db:
          pvc:
            storageClassName: "longhorn-retain"
        config:
          Authenticator:
            admin_users:
              - sobrinho
          DummyAuthenticator:
            password: admin
          JupyterHub:
            authenticator_class: dummy
          IdentityProvider:
            token: ""
      prePuller:
        continuous:
          enabled: false
        hook:
          enabled: false
      proxy:
        service:
          type: ClusterIP
      singleuser:
        storage:
          dynamic:
            pvcNameTemplate: jupyter-pvc-{username}
            volumeNameTemplate: jupyter-pv-{username}
            storageClass: "longhorn-retain"
          capacity: 5Gi
          homeMountPath: /home/jovyan
          extraVolumeMounts: 
            - mountPath: /dev/ttyACM0
              name: chipwhisperer
          extraVolumes:
            - hostPath:
                path: /dev/serial/by-id/usb-NewAE_Technology_Inc._ChipWhisperer_Lite_50203220343043543230333232323034-if01
              name: chipwhisperer
        nodeSelector:
          feature.node.kubernetes.io/usb-chipwhisperer.present: "true"

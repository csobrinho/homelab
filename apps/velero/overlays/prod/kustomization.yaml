# From https://github.com/vmware-tanzu/helm-charts/blob/main/charts/velero/values.yaml
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ../../base
  - resource-policy.yaml
  - secrets/velero-secret-enc.yaml

helmCharts:
  - name: velero
    repo: https://vmware-tanzu.github.io/helm-charts
    releaseName: velero
    namespace: velero
    version: 8.7.1
    includeCRDs: true
    valuesInline:
      nodeSelector:
        kubernetes.io/arch: "arm64"
      initContainers:
        - name: velero-plugin-for-aws
          image: velero/velero-plugin-for-aws:v1.11.1
          imagePullPolicy: IfNotPresent
          volumeMounts:
            - mountPath: /target
              name: plugins
      metrics:
        enabled: false
      configuration:
        backupStorageLocation:
          - name: default
            provider: aws
            bucket: velero
            default: true
            accessMode: ReadWrite
            credential:
              name: velero-secret
              key: cloud
            config:
              checksumAlgorithm: ""
              region: us-east-1
              s3ForcePathStyle: "true"
              s3Url: http://rook-ceph-rgw-ceph-objectstore.rook-ceph.svc
              caCert: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUZCakNDQSs2Z0F3SUJBZ0lTQS8vL242M1JJTDl2aVptWHRKWGFDY0pFTUEwR0NTcUdTSWIzRFFFQkN3VUEKTURNeEN6QUpCZ05WQkFZVEFsVlRNUll3RkFZRFZRUUtFdzFNWlhRbmN5QkZibU55ZVhCME1Rd3dDZ1lEVlFRRApFd05TTVRBd0hoY05NalV3TWpFNE1qTXdNek13V2hjTk1qVXdOVEU1TWpNd016STVXakFXTVJRd0VnWURWUVFECkV3dHpiMkp5YVc1b2J5NXdkRENDQVNJd0RRWUpLb1pJaHZjTkFRRUJCUUFEZ2dFUEFEQ0NBUW9DZ2dFQkFONVQKUXl2TEk1WlhPRHVFY0JncFhwakdvSy9xbWtrMWNCelArTkxpZk9ub0FPYkRzRkhsaWgxT2RZbmNpTnNwR2krKwppcEgxOEFnNGRGM1U0OU9JSzh5R2FuSjdHOHRjM1RsZi95WTMxb3pIaTVJSzRNN2pzMjFXNEFJMC9OWWtTSTBuCnhwYllydTJTeEwzU0Z1R3ZaYktKVzFJNjAwTEpwZlVtQmx6ZzlnY2RId2E0aWdMT1VsVjJTN0JCeUpzcEtmTFAKS0RuUEFtUU41c2xNcisyT0pJbGIxK1FOeVdZd2RZWDYzL1N5ZWFna0pXY25MNExrZEN4c3NuQTl0YkJzNWI5MApaN0xIYjA3WlJKRWNPZjZia1lKQUI5VTI2bUJ6L2o5bUljdjkxUHVPcjBQZWNqSXYxNUVnS1dhM2w4M3dqVDlCCk5zdmhxWGlFM3NCL2tCaFNvV2tDQXdFQUFhT0NBaTh3Z2dJck1BNEdBMVVkRHdFQi93UUVBd0lGb0RBZEJnTlYKSFNVRUZqQVVCZ2dyQmdFRkJRY0RBUVlJS3dZQkJRVUhBd0l3REFZRFZSMFRBUUgvQkFJd0FEQWRCZ05WSFE0RQpGZ1FVTS9MSWh3Skx2RVM5UnVWalhwWUZjT2xKRGlzd0h3WURWUjBqQkJnd0ZvQVV1N3pEUjZYa3ZLbkd3NlJ5CkRCQ05valhoeU9nd1Z3WUlLd1lCQlFVSEFRRUVTekJKTUNJR0NDc0dBUVVGQnpBQmhoWm9kSFJ3T2k4dmNqRXcKTG04dWJHVnVZM0l1YjNKbk1DTUdDQ3NHQVFVRkJ6QUNoaGRvZEhSd09pOHZjakV3TG1rdWJHVnVZM0l1YjNKbgpMekEzQmdOVkhSRUVNREF1Z2hBcUxtTnpMbk52WW5KcGJtaHZMbkIwZ2cwcUxuTnZZbkpwYm1odkxuQjBnZ3R6CmIySnlhVzVvYnk1d2REQVRCZ05WSFNBRUREQUtNQWdHQm1lQkRBRUNBVENDQVFNR0Npc0dBUVFCMW5rQ0JBSUUKZ2ZRRWdmRUE3d0IyQUhNZ0lnOElGb3I1ODhTbWl3cXlhcHBLQU83MWQ0V0tDRTBGQU5TbFFrUlpBQUFCbFJ1Qwo4RDBBQUFRREFFY3dSUUloQU1zbmNYOENQaGxtbVlOWE5ydWtwSFQwMVA3akEvOVZsT2Q5QzlyNzlDUjdBaUIwCnBwNjZ6N1VBS0VQd3VzUTFCWVBoS1Zvc3Y0MmJVTzJlaytyck4rZEVZQUIxQUtMakN1UkY3NzJ0bTM0NDdVZG4KZDFQWGdsdUVsTmNyWGhzc3hMbFFwRWZuQUFBQmxSdUM4RVFBQUFRREFFWXdSQUlnSEdqQ292VnRnK1dTY29MQgpkN2ppYlhXRlUyNk9kMFFxNXVsMTA5ZzlVb1FDSUEwQ2xwU3VPeHFqRkl2MHd6N1IxNEpNNjhYT2xMbWZ6a0J6Cmhqd1RNYmxTTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElCQVFCZGFMdzNqeVlCS3g4c1VDMHI2LzhVb2Jmdy84aUEKSkZKQU01Q0lFUUs3MEE4a2IzQ0VtUjVkOGpqek42a0sxQkd3eXlSRWpFMjMraUtkSXd2OHNlQmdFekdQdTdBdQpDU0sraGZ5V0RtOGRIQTFYK0ZwSjVzRTl2Z3NWTi9tZVdJbVpSdW45cEJHdmZsNnl0UFlTREQxTktPbTdmRVlQCmxrRmlYcEV3Mk1ONThiK0l4K3F1Yll1YjBDem1GZ1ExMXRUOExJQ0JVbU5aYVc2bEJteXo1N2I3WmxKUWpjY08KTGNsdFJHY1VNWGlnT1hCaG5UazlkY09TekRrNWd1amhQUGpXd2w3RU55dzVROExNakwwbk82d2d2THNtSUNIdgpJUk9FeENDY21sS3FRS1BNOEdZNHEwUTJZQ0RobXQwbUdXSW9IVThJeURvZXVXZUkrcWVHcXpjdgotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCi0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQpNSUlGQlRDQ0F1MmdBd0lCQWdJUVM2aFNrL2VhTDZKekJrdW9CSTExMERBTkJna3Foa2lHOXcwQkFRc0ZBREJQCk1Rc3dDUVlEVlFRR0V3SlZVekVwTUNjR0ExVUVDaE1nU1c1MFpYSnVaWFFnVTJWamRYSnBkSGtnVW1WelpXRnkKWTJnZ1IzSnZkWEF4RlRBVEJnTlZCQU1UREVsVFVrY2dVbTl2ZENCWU1UQWVGdzB5TkRBek1UTXdNREF3TURCYQpGdzB5TnpBek1USXlNelU1TlRsYU1ETXhDekFKQmdOVkJBWVRBbFZUTVJZd0ZBWURWUVFLRXcxTVpYUW5jeUJGCmJtTnllWEIwTVF3d0NnWURWUVFERXdOU01UQXdnZ0VpTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElCRHdBd2dnRUsKQW9JQkFRRFBWK1hteEZRUzdiUkgvc2tuV0haR1VDaU1IVDZJM3dXZDFiVVlLYjNkdFZxLyt2Yk9vNzZ2QUNGTApZbHBhUEFFdnhWZ0Q5b24vamhGRDY4RzE0QlFIbG85dkg5Zm51b0U1Q1hWbHQ4S3ZHRnMzSmlqbm8vUUhLMjBhCi82dFl2Sld1UVAvcHkxZkV0VnQvZUEwWVlid1g1MVRHdTBtUnpXNFkwWUNGN3FabE5yeDA2cnhRVE9yOElmTTQKRnBPVXVyRFRhemdHelJZU2VzcFNkY2l0ZHJMQ25GMllSVnh2WVh2R0xlNDhFMUtHQWRsWDVqZ2MzNDIxSDVLUgptdWRLSE14RnFISlY4TERtb3dmcy9hY2JacDQvU0l0eGhIRll5VHI2NzE3eVcwUXJQSFRuajdKSHdRZHF6WnEzCkRaYjNFb0VtVVZRSzdHSDI5L1hpOG9ySWxRMk5BZ01CQUFHamdmZ3dnZlV3RGdZRFZSMFBBUUgvQkFRREFnR0cKTUIwR0ExVWRKUVFXTUJRR0NDc0dBUVVGQndNQ0JnZ3JCZ0VGQlFjREFUQVNCZ05WSFJNQkFmOEVDREFHQVFILwpBZ0VBTUIwR0ExVWREZ1FXQkJTN3ZNTkhwZVM4cWNiRHBISU1FSTJpTmVISTZEQWZCZ05WSFNNRUdEQVdnQlI1CnRGbm1lN2JsNUFGemdBaUl5QnBZOXVtYmJqQXlCZ2dyQmdFRkJRY0JBUVFtTUNRd0lnWUlLd1lCQlFVSE1BS0cKRm1oMGRIQTZMeTk0TVM1cExteGxibU55TG05eVp5OHdFd1lEVlIwZ0JBd3dDakFJQmdabmdRd0JBZ0V3SndZRApWUjBmQkNBd0hqQWNvQnFnR0lZV2FIUjBjRG92TDNneExtTXViR1Z1WTNJdWIzSm5MekFOQmdrcWhraUc5dzBCCkFRc0ZBQU9DQWdFQWtySG5RVGZyZVoyQjVzM2lKZUU2SU9tUVJKV2pnVnpQdzEzOXZhQncxYkdXS0NJTDB2SW8Kend6bjFPWkRqQ1FpSGNGQ2t0RUpyNTlMOU1od1R5QVdzVnJkQWZZZitCOWhheFFuc0hLTlk2N3U0czVMenpmZAp1NlBVemVldFVLMjl2K1BzUG1JMmNKa3hwK2lOM2VwaTRoS3U5WnpVUFN3TXF0Q2NlYjdxUFZ4RWJwWXhZMXA5CjFuNVBKS0JMQlg5ZWI5TFU2bDh6U3hQV1Y3YkszbEc0WGFNSmduVDl4M2llczdtc0Z0cEtLNWJEdG90aWovbDAKR2FLZUE5N3BiNXV3RDlLZ1d2YUZYTUlFdDhqVlRqTEV2d1JkdkNuMjk0R1BERjA4VThsQWtJdjd0Z2hsdWFRaAoxUW5sRTRTRU40TE9FQ2o4ZHNJR0pYcEdVazNhVTNLa0p6OWljS3krYVVnQSsyY1AyMXVoNk5jRElTM1h5ZmFaClFqbURROTkzQ2hJSThTWFd1cFFaVkJpSXBjV080UnFaazNscjdCejVNVUN3ekRJQTM1OWU1N1NTcTVDQ2tZME4KNEI2VnVsazdMa3Rmd3JkR05WSTVCc0M5cXF4U3dTS2dSSmVaOXd5Z0lhZWhiSEZIRmhjQmFNREtwaVpsQkh5egpyc25ubEZYQ2I1czhIS241THNVZ0d2QjI0TDdzR05aUDJDWDdkaEhvditZaEQram96TFcycDlXNDk1OUJ6MkVpClJtcUR0bWlYTG56cVRwWGJJK3N1eUNzb2hLUmc2VW4wUkM0NytjcGlWd0hpWFpBVytjbjhlaU5JanFiVmdYTHgKS1BwZHp2dnRUbk9QbEM3U1FaU1ltZHVucjNCZjliNzdBaUMvWmlkc3RLMzZkUklMS3o3T0E1ND0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
        volumeSnapshotLocation:
          - name: default
            provider: csi
        features: EnableCSI
        defaultBackupStorageLocation: default
        defaultVolumeSnapshotLocations: csi:default
        logFormat: json
        defaultSnapshotMoveData: true
        defaultVolumesToFsBackup: true
        extraEnvVars:
          TZ: America/Los_Angeles
      credentials:
        useSecret: true
        existingSecret: velero-secret
      schedules:
        cluster-full-backup:
          disabled: false
          schedule: "24 7,13,22 * * *"
          useOwnerReferencesInBackup: false
          template:
            datamover: velero
            resourcePolicy:
              kind: configmap
              name: resource-policy
            snapshotMoveData: true
            snapshotVolumes: true
            ttl: "480h0m0s" # 20 days.
            uploaderConfig:
              parallelFilesUpload: 10
